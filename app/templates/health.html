<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š Health Dashboard - Hydrus</title>
    <link rel="stylesheet" href="/static/health.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">
</head>
<body>
    <div class="dashboard">
        <!-- CABEÃ‡ALHO -->
        <div class="header">
            <h1>
                <i class="fas fa-heartbeat"></i>
                Health Dashboard
                <span class="project-name">Hydrus</span>
            </h1>
            <p>Monitoramento em tempo real do sistema</p>
            <div class="last-update">
                <i class="fas fa-sync-alt"></i>
                Atualizado: <span id="update-time">{{ current_time }}</span>
                <button onclick="refreshData()" class="refresh-btn">
                    <i class="fas fa-redo"></i> Atualizar
                </button>
            </div>
        </div>

        <!-- STATUS GERAL -->
        <div class="overall-status {{ 'healthy' if overall_status == 'healthy' else 'unhealthy' }}">
            <div class="status-icon">
                <i class="fas fa-{{ 'check-circle' if overall_status == 'healthy' else 'exclamation-circle' }}"></i>
            </div>
            <div class="status-info">
                <h2>Sistema {{ 'Operacional' if overall_status == 'healthy' else 'Com Problemas' }}</h2>
                <p>{{ status_message }}</p>
            </div>
            <div class="uptime">
                <i class="fas fa-clock"></i>
                <span>Uptime: {{ uptime }}</span>
            </div>
        </div>

        <!-- GRID DE MÃ‰TRICAS -->
        <div class="metrics-grid">
            <!-- SERVER HEALTH -->
            <div class="metric-card server">
                <div class="metric-header">
                    <i class="fas fa-server"></i>
                    <h3>Servidor</h3>
                </div>
                <div class="metric-content">
                    <div class="metric-item">
                        <span class="label">Hostname:</span>
                        <span class="value">{{ server.hostname }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">IP:</span>
                        <span class="value">{{ server.ip }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Python:</span>
                        <span class="value">{{ server.python_version }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Flask:</span>
                        <span class="value">{{ server.flask_version }}</span>
                    </div>
                </div>
            </div>

            <!-- SYSTEM RESOURCES -->
            <div class="metric-card system">
                <div class="metric-header">
                    <i class="fas fa-microchip"></i>
                    <h3>Sistema</h3>
                </div>
                <div class="metric-content">
                    <div class="metric-item">
                        <span class="label">CPU:</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ system.cpu_percent }}%"></div>
                        </div>
                        <span class="value">{{ system.cpu_percent }}%</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">MemÃ³ria:</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ system.memory_percent }}%"></div>
                        </div>
                        <span class="value">{{ system.memory_percent }}%</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Disco:</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ system.disk_percent }}%"></div>
                        </div>
                        <span class="value">{{ system.disk_percent }}%</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Load Avg:</span>
                        <span class="value">{{ system.load_average }}</span>
                    </div>
                </div>
            </div>

            <!-- APPLICATION -->
            <div class="metric-card app">
                <div class="metric-header">
                    <i class="fas fa-code"></i>
                    <h3>AplicaÃ§Ã£o</h3>
                </div>
                <div class="metric-content">
                    <div class="metric-item">
                        <span class="label">Status:</span>
                        <span class="status-badge {{ 'healthy' if application.status == 'running' else 'unhealthy' }}">
                            {{ application.status }}
                        </span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Porta:</span>
                        <span class="value">{{ application.port }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Requests:</span>
                        <span class="value">{{ application.request_count }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Tempo resposta:</span>
                        <span class="value">{{ application.response_time }}ms</span>
                    </div>
                </div>
            </div>

            <!-- NETWORK -->
            <div class="metric-card network">
                <div class="metric-header">
                    <i class="fas fa-network-wired"></i>
                    <h3>Rede</h3>
                </div>
                <div class="metric-content">
                    <div class="metric-item">
                        <span class="label">Cliente IP:</span>
                        <span class="value">{{ client.ip }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">User Agent:</span>
                        <span class="value truncate">{{ client.user_agent }}</span>
                    </div>
                    <div class="metric-item">
                        <span class="label">Endpoints:</span>
                        <div class="endpoints">
                            {% for endpoint, url in endpoints.items() %}
                            <a href="{{ url }}" class="endpoint-link">{{ endpoint }}</a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÃšLTIMAS ATIVIDADES -->
        <div class="activity-section">
            <h3><i class="fas fa-history"></i> Ãšltimas Atividades</h3>
            <div class="activity-list">
                {% for activity in activities %}
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-{{ activity.icon }}"></i>
                    </div>
                    <div class="activity-content">
                        <p class="activity-text">{{ activity.message }}</p>
                        <span class="activity-time">{{ activity.time }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div class="footer-links">
                <a href="/" class="footer-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="/health/json" class="footer-link">
                    <i class="fas fa-code"></i> JSON API
                </a>
                <a href="https://github.com/Guilhermeabtibol/hydrus" class="footer-link" target="_blank">
                    <i class="fab fa-github"></i> GitHub
                </a>
            </div>
            <p class="footer-note">
                <i class="fas fa-heart"></i> Hydrus Health Dashboard â€¢ 
                Monitoramento DevOps â€¢ GVoxx
            </p>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // Atualizar tempo
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('pt-BR');
            document.getElementById('update-time').textContent = timeStr;
        }

        // Atualizar dados
        async function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
            
            try {
                const response = await fetch('/health/api');
                const data = await response.json();
                
                // Atualizar mÃ©tricas (simplificado - em produÃ§Ã£o seria mais complexo)
                updateTime();
                
                // Simular atualizaÃ§Ã£o de progress bars
                document.querySelectorAll('.progress-fill').forEach(bar => {
                    const randomChange = Math.random() * 10 - 5; // +/-5%
                    let currentWidth = parseFloat(bar.style.width);
                    currentWidth = Math.max(0, Math.min(100, currentWidth + randomChange));
                    bar.style.width = currentWidth + '%';
                    bar.parentElement.nextElementSibling.textContent = currentWidth.toFixed(1) + '%';
                });
                
            } catch (error) {
                console.error('Erro ao atualizar:', error);
            }
            
            btn.innerHTML = '<i class="fas fa-redo"></i> Atualizar';
        }

        // Atualizar tempo a cada segundo
        setInterval(updateTime, 1000);

        // Atualizar automÃ¡tico a cada 30 segundos
        setInterval(refreshData, 30000);

        // Efeito de digitaÃ§Ã£o no tÃ­tulo
        const projectName = document.querySelector('.project-name');
        const originalText = projectName.textContent;
        projectName.textContent = '';
        let charIndex = 0;
        
        function typeEffect() {
            if (charIndex < originalText.length) {
                projectName.textContent += originalText.charAt(charIndex);
                charIndex++;
                setTimeout(typeEffect, 100);
            }
        }
        
        // Iniciar efeitos
        document.addEventListener('DOMContentLoaded', () => {
            typeEffect();
            updateTime();
        });
    </script>
</body>
</html>
